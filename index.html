<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Caffeine Reaction Time Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background-color: #f0f0f0;
        }
        .container {
            text-align: center;
            background-color: white;
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            max-width: 500px;
            width: 100%;
        }
        #target-area {
            width: 200px;
            height: 200px;
            margin: 2rem auto;
            border-radius: 50%;
            cursor: pointer;
            transition: background-color 0s ease;
        }
        /* Previous CSS remains the same */
    </style>
</head>
<body>
    <!-- Previous HTML content remains the same -->
    <script>
        class ReactionTimeExperiment {
            constructor(config = {}) {
                this.config = {
                    totalTrials: 4,
                    minDelay: 1000,
                    maxDelay: 3000,
                    earlyClickPenalty: -500, // Negative value for early clicks
                    ...config
                };

                // Previous element and state initialization remains the same
            }

            // Previous methods remain the same, with modifications to handleClick and recordTrial

            handleClick() {
                if (!this.state.isRunning) return;

                const currentTime = performance.now();
                const reactionTime = Math.round(currentTime - this.startTime);

                if (this.elements.targetArea.style.backgroundColor === 'green') {
                    this.recordTrial(reactionTime);
                } else {
                    // Early click handling
                    this.recordTrial(this.config.earlyClickPenalty);
                    this.elements.instructions.textContent = `Early click! Penalty: ${this.config.earlyClickPenalty} ms`;
                }
            }

            recordTrial(reactionTime) {
                const trialData = {
                    participantId: document.getElementById('participant-id').value,
                    coffeeLevel: document.getElementById('drink-level').value,
                    reactionTime,
                    isEarlyClick: reactionTime < 0,
                    tags: [...this.state.tags],
                    timestamp: new Date().toISOString()
                };

                this.state.trials.push(trialData);
                this.elements.reactionTimeDisplay.textContent = reactionTime;
                this.state.currentTrial++;

                if (this.state.currentTrial < this.config.totalTrials) {
                    this.runTrial();
                } else {
                    this.showResults();
                }
            }

            showResults() {
                this.elements.test.style.display = 'none';
                this.elements.results.style.display = 'block';

                // Exclude early clicks from average calculation
                const validTrials = this.state.trials.filter(trial => trial.reactionTime >= 0);
                const averageTime = validTrials.length > 0 
                    ? validTrials.reduce((sum, trial) => sum + trial.reactionTime, 0) / validTrials.length
                    : 0;

                this.elements.averageTimeDisplay.textContent = averageTime.toFixed(2);
            }

            // Remaining methods stay the same
        }

        document.addEventListener('DOMContentLoaded', () => {
            new ReactionTimeExperiment();
        });
    </script>
</body>
</html>
